[gd_scene load_steps=4 format=3 uid="uid://brtgpcmu3mw2"]

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_58g2c"]
friction = 0.2

[sub_resource type="GDScript" id="GDScript_qgcaa"]
script/source = "extends RigidBody2D

const segment_scene = preload('res://objects/rope_segment.tscn')

var prev_segment: PhysicsBody2D: set = _set_prev_segment
var next_segment: PhysicsBody2D

func _set_prev_segment(segment: PhysicsBody2D):
	prev_segment = segment
	
func add_segment_as_sibling() -> PhysicsBody2D:
	var sibling: RigidBody2D
	sibling = segment_scene.instantiate()
	add_sibling(sibling)

	sibling.global_position = $Marker2D.global_position
	sibling.global_rotation = global_rotation
	sibling.prev_segment = self

	next_segment = sibling
	$PinJoint2D.node_a = sibling.get_path()
	
	return sibling
"

[sub_resource type="SegmentShape2D" id="SegmentShape2D_6nxcq"]
b = Vector2(0, 20)

[node name="RopeSegment" type="RigidBody2D"]
collision_layer = 2
collision_mask = 2
center_of_mass_mode = 1
center_of_mass = Vector2(0, 20)
physics_material_override = SubResource("PhysicsMaterial_58g2c")
linear_damp = 0.5
angular_damp = 3.0
script = SubResource("GDScript_qgcaa")

[node name="ColorRect" type="ColorRect" parent="."]
visible = false
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -1.0
offset_right = 1.0
offset_bottom = 20.0
grow_horizontal = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("SegmentShape2D_6nxcq")

[node name="Marker2D" type="Marker2D" parent="."]
position = Vector2(0, 20)

[node name="PinJoint2D" type="PinJoint2D" parent="."]
node_b = NodePath("..")
softness = 0.01
